<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Isolation Forest åˆ‡å‰²éç¨‹è¦–è¦ºåŒ–</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft JhengHei', 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            padding: 40px;
        }
        
        h1 {
            text-align: center;
            color: #667eea;
            margin-bottom: 10px;
            font-size: 2.5em;
        }
        
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
            font-size: 1.1em;
        }
        
        .tutorial {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            border-left: 5px solid #667eea;
        }
        
        .tutorial h3 {
            color: #667eea;
            margin-bottom: 15px;
        }
        
        .tutorial ol {
            margin-left: 25px;
            line-height: 1.8;
        }
        
        .controls {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .control-row {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
            flex-wrap: wrap;
            align-items: center;
        }
        
        button {
            padding: 12px 24px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 1em;
            cursor: pointer;
            transition: transform 0.2s;
            font-weight: bold;
        }
        
        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        
        .btn-success {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        
        .canvas-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .canvas-wrapper {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 15px;
        }
        
        .canvas-wrapper h3 {
            color: #667eea;
            margin-bottom: 10px;
            text-align: center;
        }
        
        canvas {
            border: 2px solid #e0e7ff;
            border-radius: 8px;
            display: block;
            margin: 0 auto;
            cursor: crosshair;
        }
        
        @media (max-width: 1200px) {
            .canvas-container {
                grid-template-columns: 1fr;
            }
        }
        
        .info-panel {
            background: #f8f9ff;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .info-panel h3 {
            color: #667eea;
            margin-bottom: 15px;
        }
        
        .cut-info {
            background: white;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
        }
        
        .cut-info.active {
            border-left-color: #e74c3c;
            background: #fff5f5;
        }
        
        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 50%;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .stat-item {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #667eea;
        }
        
        .stat-label {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 5px;
        }
        
        .stat-value {
            color: #667eea;
            font-size: 1.5em;
            font-weight: bold;
        }
        
        .point-status {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 10px;
        }
        
        .point-badge {
            padding: 5px 12px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: bold;
        }
        
        .point-badge.isolated {
            background: #e74c3c;
            color: white;
        }
        
        .point-badge.active {
            background: #3498db;
            color: white;
        }
        
        .highlight-box {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin-top: 10px;
        }
        
        .highlight-box strong {
            color: #856404;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”ª Isolation Forest åˆ‡å‰²éç¨‹è¦–è¦ºåŒ–</h1>
        <p class="subtitle">çœ‹çœ‹æ¯ä¸€åˆ€æ€éº¼æŠŠç•°å¸¸é»å­¤ç«‹å‡ºä¾†ï¼</p>
        
        <div class="tutorial">
            <h3>ğŸ“š ä½¿ç”¨èªªæ˜</h3>
            <ol>
                <li><strong>é»æ“Šå·¦å´ç•«å¸ƒ</strong>æ–°å¢è³‡æ–™é»ï¼ˆå»ºè­° 10-20 å€‹é»ï¼‰</li>
                <li>æˆ–ä½¿ç”¨<strong>ã€Œç”Ÿæˆç¯„ä¾‹è³‡æ–™ã€</strong>å¿«é€Ÿå»ºç«‹è³‡æ–™</li>
                <li>é»æ“Š<strong>ã€Œé–‹å§‹å»ºç«‹å­¤ç«‹æ¨¹ã€</strong>é–‹å§‹åˆ‡å‰²éç¨‹</li>
                <li>ä½¿ç”¨<strong>ã€Œä¸‹ä¸€åˆ€ã€</strong>æŒ‰éˆ•é€æ­¥è§€çœ‹æ¯æ¬¡åˆ‡å‰²</li>
                <li>è§€å¯Ÿ<strong>å³å´è¦–åœ–</strong>ï¼šçœ‹å“ªäº›é»è¢«å­¤ç«‹äº†ï¼ˆç´…è‰²ï¼‰</li>
                <li><strong>ç•°å¸¸é»æœƒæ›´æ—©è¢«å­¤ç«‹</strong>ï¼ˆéœ€è¦è¼ƒå°‘çš„åˆ‡å‰²æ¬¡æ•¸ï¼‰</li>
            </ol>
        </div>
        
        <div class="controls">
            <div class="control-row">
                <button onclick="generateSampleData()">ğŸ² ç”Ÿæˆç¯„ä¾‹è³‡æ–™</button>
                <button onclick="clearData()" class="btn-secondary">ğŸ—‘ï¸ æ¸…ç©ºè³‡æ–™</button>
                <button onclick="startIsolation()" id="startBtn" class="btn-success">â–¶ï¸ é–‹å§‹å»ºç«‹å­¤ç«‹æ¨¹</button>
                <button onclick="nextCut()" id="nextBtn" disabled>â¡ï¸ ä¸‹ä¸€åˆ€ï¼ˆåˆ‡å‰²ï¼‰</button>
                <button onclick="autoPlay()" id="autoBtn" disabled>â© è‡ªå‹•æ’­æ”¾</button>
                <button onclick="reset()" id="resetBtn" disabled class="btn-secondary">ğŸ”„ é‡æ–°é–‹å§‹</button>
            </div>
        </div>
        
        <div class="canvas-container">
            <div class="canvas-wrapper">
                <h3>ğŸ“ åŸå§‹è³‡æ–™é»åˆ†å¸ƒ</h3>
                <canvas id="originalCanvas" width="600" height="600"></canvas>
            </div>
            <div class="canvas-wrapper">
                <h3>ğŸ”ª åˆ‡å‰²éç¨‹è¦–è¦ºåŒ–</h3>
                <canvas id="cutCanvas" width="600" height="600"></canvas>
            </div>
        </div>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: #3498db;"></div>
                <span>æ´»èºé»ï¼ˆå°šæœªå­¤ç«‹ï¼‰</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #e74c3c;"></div>
                <span>å·²å­¤ç«‹é»</span>
            </div>
            <div class="legend-item">
                <div style="width: 20px; height: 3px; background: #2ecc71;"></div>
                <span>åˆ‡å‰²ç·š</span>
            </div>
        </div>
        
        <div class="info-panel">
            <h3>ğŸ“Š åˆ‡å‰²è³‡è¨Š</h3>
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-label">ç¸½è³‡æ–™é»æ•¸</div>
                    <div class="stat-value" id="totalPoints">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">å·²åˆ‡å‰²æ¬¡æ•¸</div>
                    <div class="stat-value" id="cutCount">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">å·²å­¤ç«‹é»æ•¸</div>
                    <div class="stat-value" id="isolatedCount">0</div>
                </div>
                <div class="stat-item">
                    <div class="stat-label">å‰©é¤˜æ´»èºé»æ•¸</div>
                    <div class="stat-value" id="activeCount">0</div>
                </div>
            </div>
            
            <div id="currentCutInfo" class="cut-info" style="margin-top: 20px; display: none;">
                <strong>ç•¶å‰åˆ‡å‰²ï¼š</strong>
                <div id="cutDetails"></div>
                <div class="point-status" id="pointStatus"></div>
            </div>
            
            <div class="highlight-box" style="margin-top: 15px;">
                <strong>ğŸ’¡ è§€å¯Ÿé‡é»ï¼š</strong>
                <div id="observation">é»æ“Šã€Œé–‹å§‹å»ºç«‹å­¤ç«‹æ¨¹ã€é–‹å§‹è§€å¯Ÿåˆ‡å‰²éç¨‹...</div>
            </div>
        </div>
    </div>

    <script>
        const originalCanvas = document.getElementById('originalCanvas');
        const cutCanvas = document.getElementById('cutCanvas');
        const originalCtx = originalCanvas.getContext('2d');
        const cutCtx = cutCanvas.getContext('2d');
        
        let dataPoints = [];
        let cuts = [];
        let currentCutIndex = 0;
        let isolatedPoints = new Set();
        let isPlaying = false;
        
        const CANVAS_SIZE = 600;
        const MARGIN = 50;
        const PLOT_SIZE = CANVAS_SIZE - 2 * MARGIN;
        const DATA_RANGE = 10;
        
        // åº§æ¨™è½‰æ›
        function dataToCanvas(x, y) {
            const canvasX = MARGIN + (x / DATA_RANGE) * PLOT_SIZE;
            const canvasY = CANVAS_SIZE - MARGIN - (y / DATA_RANGE) * PLOT_SIZE;
            return [canvasX, canvasY];
        }
        
        function canvasToData(canvasX, canvasY) {
            const x = ((canvasX - MARGIN) / PLOT_SIZE) * DATA_RANGE;
            const y = ((CANVAS_SIZE - MARGIN - canvasY) / PLOT_SIZE) * DATA_RANGE;
            return [Math.max(0, Math.min(DATA_RANGE, x)), Math.max(0, Math.min(DATA_RANGE, y))];
        }
        
        // ç¹ªè£½åº§æ¨™è»¸
        function drawAxes(ctx) {
            ctx.strokeStyle = '#ddd';
            ctx.lineWidth = 1;
            
            // ç¶²æ ¼ç·š
            for (let i = 0; i <= 10; i++) {
                const pos = MARGIN + (i / 10) * PLOT_SIZE;
                ctx.beginPath();
                ctx.moveTo(pos, MARGIN);
                ctx.lineTo(pos, CANVAS_SIZE - MARGIN);
                ctx.stroke();
                
                ctx.beginPath();
                ctx.moveTo(MARGIN, pos);
                ctx.lineTo(CANVAS_SIZE - MARGIN, pos);
                ctx.stroke();
            }
            
            // åº§æ¨™è»¸
            ctx.strokeStyle = '#333';
            ctx.lineWidth = 2;
            ctx.beginPath();
            ctx.moveTo(MARGIN, CANVAS_SIZE - MARGIN);
            ctx.lineTo(CANVAS_SIZE - MARGIN, CANVAS_SIZE - MARGIN);
            ctx.lineTo(CANVAS_SIZE - MARGIN, MARGIN);
            ctx.stroke();
            
            // æ¨™ç±¤
            ctx.fillStyle = '#666';
            ctx.font = '14px Arial';
            ctx.textAlign = 'center';
            ctx.fillText('0', MARGIN, CANVAS_SIZE - MARGIN + 20);
            ctx.fillText('10', CANVAS_SIZE - MARGIN, CANVAS_SIZE - MARGIN + 20);
            ctx.textAlign = 'right';
            ctx.fillText('0', MARGIN - 10, CANVAS_SIZE - MARGIN + 5);
            ctx.fillText('10', MARGIN - 10, MARGIN + 5);
        }
        
        // ç¹ªè£½é»
        function drawPoints(ctx, points, isolatedSet = new Set(), highlightActive = false) {
            points.forEach((point, idx) => {
                const [x, y] = dataToCanvas(point[0], point[1]);
                const isIsolated = isolatedSet.has(idx);
                
                ctx.beginPath();
                ctx.arc(x, y, isIsolated ? 8 : 10, 0, 2 * Math.PI);
                
                if (isIsolated) {
                    ctx.fillStyle = '#e74c3c';
                    ctx.fill();
                    // ç•« X
                    ctx.strokeStyle = 'white';
                    ctx.lineWidth = 2;
                    ctx.beginPath();
                    ctx.moveTo(x - 4, y - 4);
                    ctx.lineTo(x + 4, y + 4);
                    ctx.moveTo(x + 4, y - 4);
                    ctx.lineTo(x - 4, y + 4);
                    ctx.stroke();
                } else {
                    ctx.fillStyle = highlightActive ? '#3498db' : '#3498db';
                    ctx.fill();
                    ctx.strokeStyle = 'white';
                    ctx.lineWidth = 2;
                    ctx.stroke();
                }
            });
        }
        
        // ç¹ªè£½åˆ‡å‰²ç·š
        function drawCut(ctx, cut) {
            const { axis, value } = cut;
            ctx.strokeStyle = '#2ecc71';
            ctx.lineWidth = 3;
            ctx.setLineDash([10, 5]);
            
            ctx.beginPath();
            if (axis === 'x') {
                const [x, _] = dataToCanvas(value, 0);
                ctx.moveTo(x, MARGIN);
                ctx.lineTo(x, CANVAS_SIZE - MARGIN);
            } else {
                const [_, y] = dataToCanvas(0, value);
                ctx.moveTo(MARGIN, y);
                ctx.lineTo(CANVAS_SIZE - MARGIN, y);
            }
            ctx.stroke();
            ctx.setLineDash([]);
        }
        
        // åˆå§‹åŒ–ç•«å¸ƒ
        function initCanvas() {
            originalCtx.clearRect(0, 0, CANVAS_SIZE, CANVAS_SIZE);
            cutCtx.clearRect(0, 0, CANVAS_SIZE, CANVAS_SIZE);
            drawAxes(originalCtx);
            drawAxes(cutCtx);
            drawPoints(originalCtx, dataPoints);
            updateStats();
        }
        
        // é»æ“Šæ–°å¢é»
        originalCanvas.addEventListener('click', (e) => {
            if (cuts.length > 0) return; // å·²é–‹å§‹åˆ‡å‰²ï¼Œä¸å…è¨±æ–°å¢
            
            const rect = originalCanvas.getBoundingClientRect();
            const canvasX = e.clientX - rect.left;
            const canvasY = e.clientY - rect.top;
            const [x, y] = canvasToData(canvasX, canvasY);
            
            if (x >= 0 && x <= DATA_RANGE && y >= 0 && y <= DATA_RANGE) {
                dataPoints.push([x, y]);
                initCanvas();
            }
        });
        
        // ç”Ÿæˆç¯„ä¾‹è³‡æ–™
        function generateSampleData() {
            dataPoints = [];
            
            // æ­£å¸¸é»ç¾¤ 1
            for (let i = 0; i < 15; i++) {
                dataPoints.push([
                    2 + Math.random() * 2,
                    2 + Math.random() * 2
                ]);
            }
            
            // æ­£å¸¸é»ç¾¤ 2
            for (let i = 0; i < 15; i++) {
                dataPoints.push([
                    6 + Math.random() * 2,
                    6 + Math.random() * 2
                ]);
            }
            
            // ç•°å¸¸é»
            dataPoints.push([9, 1]);
            dataPoints.push([1, 9]);
            dataPoints.push([9, 9]);
            
            reset();
            initCanvas();
        }
        
        // æ¸…ç©ºè³‡æ–™
        function clearData() {
            dataPoints = [];
            reset();
            initCanvas();
        }
        
        // é–‹å§‹å­¤ç«‹éç¨‹
        function startIsolation() {
            if (dataPoints.length < 2) {
                alert('è«‹è‡³å°‘æ–°å¢ 2 å€‹è³‡æ–™é»ï¼');
                return;
            }
            
            cuts = [];
            currentCutIndex = 0;
            isolatedPoints.clear();
            
            // ç”Ÿæˆåˆ‡å‰²åºåˆ—
            generateCuts();
            
            document.getElementById('startBtn').disabled = true;
            document.getElementById('nextBtn').disabled = false;
            document.getElementById('autoBtn').disabled = false;
            document.getElementById('resetBtn').disabled = false;
            
            updateVisualization();
            updateObservation();
        }
        
        // ç”Ÿæˆåˆ‡å‰²åºåˆ—
        function generateCuts() {
            let activePoints = new Set(dataPoints.map((_, i) => i));
            
            while (activePoints.size > 0 && cuts.length < 50) {
                // éš¨æ©Ÿé¸æ“‡è»¸å’Œåˆ‡å‰²å€¼
                const axis = Math.random() > 0.5 ? 'x' : 'y';
                const axisIdx = axis === 'x' ? 0 : 1;
                
                // å¾æ´»èºé»ä¸­æ‰¾ç¯„åœ
                const activePointsArray = Array.from(activePoints).map(i => dataPoints[i]);
                const values = activePointsArray.map(p => p[axisIdx]);
                const min = Math.min(...values);
                const max = Math.max(...values);
                const value = min + Math.random() * (max - min);
                
                cuts.push({ axis, value, activePoints: new Set(activePoints) });
                
                // æ›´æ–°æ´»èºé»ï¼šé¸æ“‡è¼ƒå°‘çš„ä¸€å´ç¹¼çºŒ
                const left = Array.from(activePoints).filter(i => dataPoints[i][axisIdx] < value);
                const right = Array.from(activePoints).filter(i => dataPoints[i][axisIdx] >= value);
                
                if (left.length === 1) {
                    isolatedPoints.add(left[0]);
                    activePoints.delete(left[0]);
                } else if (right.length === 1) {
                    isolatedPoints.add(right[0]);
                    activePoints.delete(right[0]);
                } else if (left.length === 0 || right.length === 0) {
                    // ç„¡æ•ˆåˆ‡å‰²ï¼Œæ‰€æœ‰é»éƒ½åœ¨ä¸€å´
                    cuts.pop();
                    continue;
                } else {
                    // é¸æ“‡è¼ƒå°‘çš„ä¸€å´ç¹¼çºŒ
                    activePoints = new Set(left.length < right.length ? left : right);
                }
            }
        }
        
        // ä¸‹ä¸€åˆ€
        function nextCut() {
            if (currentCutIndex >= cuts.length) {
                document.getElementById('nextBtn').disabled = true;
                document.getElementById('autoBtn').disabled = true;
                updateObservation('complete');
                return;
            }
            
            currentCutIndex++;
            updateVisualization();
            updateObservation();
            
            if (currentCutIndex >= cuts.length) {
                document.getElementById('nextBtn').disabled = true;
                document.getElementById('autoBtn').disabled = true;
            }
        }
        
        // è‡ªå‹•æ’­æ”¾
        async function autoPlay() {
            if (isPlaying) return;
            isPlaying = true;
            document.getElementById('autoBtn').disabled = true;
            document.getElementById('nextBtn').disabled = true;
            
            while (currentCutIndex < cuts.length && isPlaying) {
                nextCut();
                await new Promise(resolve => setTimeout(resolve, 800));
            }
            
            isPlaying = false;
            document.getElementById('autoBtn').disabled = false;
            if (currentCutIndex < cuts.length) {
                document.getElementById('nextBtn').disabled = false;
            }
        }
        
        // æ›´æ–°è¦–è¦ºåŒ–
        function updateVisualization() {
            cutCtx.clearRect(0, 0, CANVAS_SIZE, CANVAS_SIZE);
            drawAxes(cutCtx);
            
            // ç¹ªè£½æ‰€æœ‰åˆ‡å‰²ç·š
            for (let i = 0; i < currentCutIndex; i++) {
                drawCut(cutCtx, cuts[i]);
            }
            
            // è¨ˆç®—ç•¶å‰å·²å­¤ç«‹çš„é»
            const currentIsolated = new Set();
            for (let i = 0; i < currentCutIndex; i++) {
                const cut = cuts[i];
                const axisIdx = cut.axis === 'x' ? 0 : 1;
                
                Array.from(cut.activePoints).forEach(idx => {
                    const point = dataPoints[idx];
                    const left = Array.from(cut.activePoints).filter(i => 
                        dataPoints[i][axisIdx] < cut.value
                    );
                    const right = Array.from(cut.activePoints).filter(i => 
                        dataPoints[i][axisIdx] >= cut.value
                    );
                    
                    if ((left.length === 1 && left[0] === idx) || 
                        (right.length === 1 && right[0] === idx)) {
                        currentIsolated.add(idx);
                    }
                });
            }
            
            drawPoints(cutCtx, dataPoints, currentIsolated, true);
            updateStats(currentIsolated);
            updateCutInfo(currentIsolated);
        }
        
        // æ›´æ–°çµ±è¨ˆ
        function updateStats(isolatedSet = new Set()) {
            document.getElementById('totalPoints').textContent = dataPoints.length;
            document.getElementById('cutCount').textContent = currentCutIndex;
            document.getElementById('isolatedCount').textContent = isolatedSet.size;
            document.getElementById('activeCount').textContent = dataPoints.length - isolatedSet.size;
        }
        
        // æ›´æ–°åˆ‡å‰²è³‡è¨Š
        function updateCutInfo(isolatedSet) {
            if (currentCutIndex === 0) {
                document.getElementById('currentCutInfo').style.display = 'none';
                return;
            }
            
            document.getElementById('currentCutInfo').style.display = 'block';
            const cut = cuts[currentCutIndex - 1];
            const axisName = cut.axis === 'x' ? 'X è»¸' : 'Y è»¸';
            
            document.getElementById('cutDetails').innerHTML = `
                <div style="margin-top: 10px;">
                    åˆ‡å‰²æ–¹å‘ï¼š<strong>${axisName}</strong> | 
                    åˆ‡å‰²ä½ç½®ï¼š<strong>${cut.value.toFixed(2)}</strong>
                </div>
            `;
            
            // é¡¯ç¤ºé»çš„ç‹€æ…‹
            const statusHtml = dataPoints.map((point, idx) => {
                if (isolatedSet.has(idx)) {
                    return `<span class="point-badge isolated">é» ${idx} å·²å­¤ç«‹</span>`;
                } else {
                    return `<span class="point-badge active">é» ${idx} æ´»èº</span>`;
                }
            }).join('');
            
            document.getElementById('pointStatus').innerHTML = statusHtml;
        }
        
        // æ›´æ–°è§€å¯Ÿæç¤º
        function updateObservation(status = 'progress') {
            const observationDiv = document.getElementById('observation');
            
            if (status === 'complete') {
                const pathLengths = dataPoints.map((_, idx) => {
                    for (let i = 0; i < cuts.length; i++) {
                        const cut = cuts[i];
                        const axisIdx = cut.axis === 'x' ? 0 : 1;
                        const left = Array.from(cut.activePoints).filter(j => 
                            dataPoints[j][axisIdx] < cut.value
                        );
                        const right = Array.from(cut.activePoints).filter(j => 
                            dataPoints[j][axisIdx] >= cut.value
                        );
                        
                        if ((left.length === 1 && left[0] === idx) || 
                            (right.length === 1 && right[0] === idx)) {
                            return i + 1;
                        }
                    }
                    return cuts.length;
                });
                
                const avgPath = pathLengths.reduce((a, b) => a + b, 0) / pathLengths.length;
                const minPath = Math.min(...pathLengths);
                const maxPath = Math.max(...pathLengths);
                
                observationDiv.innerHTML = `
                    <strong>åˆ‡å‰²å®Œæˆï¼</strong><br>
                    â€¢ æœ€å°‘åˆ‡å‰²æ¬¡æ•¸ï¼š${minPath} æ¬¡ï¼ˆé€™äº›é»æœ€å®¹æ˜“å­¤ç«‹ = å¯èƒ½æ˜¯ç•°å¸¸é»ï¼‰<br>
                    â€¢ æœ€å¤šåˆ‡å‰²æ¬¡æ•¸ï¼š${maxPath} æ¬¡ï¼ˆé€™äº›é»è¼ƒé›£å­¤ç«‹ = å¯èƒ½æ˜¯æ­£å¸¸é»ï¼‰<br>
                    â€¢ å¹³å‡åˆ‡å‰²æ¬¡æ•¸ï¼š${avgPath.toFixed(1)} æ¬¡<br>
                    <br>
                    <strong>é—œéµç™¼ç¾ï¼š</strong>éœ€è¦è¼ƒå°‘åˆ‡å‰²æ¬¡æ•¸å°±è¢«å­¤ç«‹çš„é»ï¼Œæ›´å¯èƒ½æ˜¯ç•°å¸¸é»ï¼
                `;
            } else if (currentCutIndex === 0) {
                observationDiv.innerHTML = `æº–å‚™é–‹å§‹åˆ‡å‰²...æ³¨æ„è§€å¯Ÿå“ªäº›é»æœƒå…ˆè¢«å­¤ç«‹å‡ºä¾†ï¼`;
            } else {
                const isolatedList = [];
                const pathLengths = dataPoints.map((_, idx) => {
                    for (let i = 0; i < currentCutIndex; i++) {
                        const cut = cuts[i];
                        const axisIdx = cut.axis === 'x' ? 0 : 1;
                        const left = Array.from(cut.activePoints).filter(j => 
                            dataPoints[j][axisIdx] < cut.value
                        );
                        const right = Array.from(cut.activePoints).filter(j => 
                            dataPoints[j][axisIdx] >= cut.value
                        );
                        
                        if ((left.length === 1 && left[0] === idx) || 
                            (right.length === 1 && right[0] === idx)) {
                            isolatedList.push({ idx, cuts: i + 1 });
                            return i + 1;
                        }
                    }
                    return null;
                }).filter(x => x !== null);
                
                if (isolatedList.length > 0) {
                    const listHtml = isolatedList
                        .sort((a, b) => a.cuts - b.cuts)
                        .map(item => `é» ${item.idx}ï¼ˆ${item.cuts} åˆ€ï¼‰`)
                        .join('ã€');
                    observationDiv.innerHTML = `
                        å·²æœ‰ ${isolatedList.length} å€‹é»è¢«å­¤ç«‹ï¼š${listHtml}<br>
                        é€™äº›é»è¢«å­¤ç«‹å¾—è¶Šæ—©ï¼Œè¶Šå¯èƒ½æ˜¯ç•°å¸¸é»ï¼
                    `;
                } else {
                    observationDiv.innerHTML = `å·²åˆ‡å‰² ${currentCutIndex} æ¬¡ï¼Œå°šæœªæœ‰é»è¢«å®Œå…¨å­¤ç«‹...`;
                }
            }
        }
        
        // é‡ç½®
        function reset() {
            cuts = [];
            currentCutIndex = 0;
            isolatedPoints.clear();
            isPlaying = false;
            
            document.getElementById('startBtn').disabled = false;
            document.getElementById('nextBtn').disabled = true;
            document.getElementById('autoBtn').disabled = true;
            document.getElementById('resetBtn').disabled = true;
            document.getElementById('currentCutInfo').style.display = 'none';
            
            initCanvas();
            updateObservation();
        }
        
        // åˆå§‹åŒ–
        initCanvas();
        generateSampleData();
    </script>
</body>
</html>