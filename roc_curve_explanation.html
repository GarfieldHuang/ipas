<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ROC æ›²ç·šäº’å‹•å¼èªªæ˜</title>
    <script src="https://cdn.plot.ly/plotly-2.26.0.min.js"></script>
    <style>
        body {
            font-family: 'Microsoft JhengHei', Arial, sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 10px;
        }
        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 30px;
        }
        .control-panel {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .slider-container {
            margin: 20px 0;
        }
        .slider-label {
            font-weight: bold;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        input[type="range"] {
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #ddd;
            outline: none;
        }
        input[type="range"]::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #4CAF50;
            cursor: pointer;
        }
        .metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        .metric-card {
            background: white;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #4CAF50;
        }
        .metric-label {
            font-size: 14px;
            color: #666;
            margin-bottom: 5px;
        }
        .metric-value {
            font-size: 24px;
            font-weight: bold;
            color: #333;
        }
        .explanation {
            background: #e3f2fd;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
            border-left: 4px solid #2196F3;
        }
        .plot-container {
            margin: 20px 0;
        }
        .legend-item {
            display: inline-block;
            margin-right: 20px;
            margin-bottom: 10px;
        }
        .legend-color {
            display: inline-block;
            width: 20px;
            height: 20px;
            margin-right: 5px;
            vertical-align: middle;
            border-radius: 3px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ROC æ›²ç·šäº’å‹•å¼èªªæ˜</h1>
        <p class="subtitle">ç†è§£åˆ‡å‰²é»(Threshold)å¦‚ä½•å½±éŸ¿ FPR å’Œ TPR</p>
        
        <div class="control-panel">
            <div class="slider-container">
                <div class="slider-label">
                    <span>åˆ‡å‰²é»(Threshold)</span>
                    <span id="threshold-value">0.00</span>
                </div>
                <input type="range" id="threshold" min="-4" max="4" step="0.1" value="0">
            </div>
            
            <div class="metrics">
                <div class="metric-card" style="border-left-color: #f44336;">
                    <div class="metric-label">False Positive Rate (FPR)</div>
                    <div class="metric-value" id="fpr-value">0.000</div>
                    <small>å½é™½æ€§ç‡ = FP / (FP + TN)</small>
                </div>
                <div class="metric-card" style="border-left-color: #4CAF50;">
                    <div class="metric-label">True Positive Rate (TPR)</div>
                    <div class="metric-value" id="tpr-value">0.000</div>
                    <small>çœŸé™½æ€§ç‡(æ•æ„Ÿåº¦) = TP / (TP + FN)</small>
                </div>
                <div class="metric-card" style="border-left-color: #FF9800;">
                    <div class="metric-label">Precision (ç²¾ç¢ºåº¦)</div>
                    <div class="metric-value" id="precision-value">0.000</div>
                    <small>TP / (TP + FP)</small>
                </div>
                <div class="metric-card" style="border-left-color: #9C27B0;">
                    <div class="metric-label">Accuracy (æº–ç¢ºåº¦)</div>
                    <div class="metric-value" id="accuracy-value">0.000</div>
                    <small>(TP + TN) / ç¸½æ•¸</small>
                </div>
            </div>
        </div>

        <div class="plot-container">
            <h3>å¸¸æ…‹åˆ†ä½ˆåœ–:é™°æ€§èˆ‡é™½æ€§æ¨£æœ¬çš„åˆ†æ•¸åˆ†ä½ˆ</h3>
            <div class="legend-item">
                <span class="legend-color" style="background: #2196F3;"></span>
                <span>çœŸé™°æ€§(True Negative)åˆ†ä½ˆ</span>
            </div>
            <div class="legend-item">
                <span class="legend-color" style="background: #f44336;"></span>
                <span>çœŸé™½æ€§(True Positive)åˆ†ä½ˆ</span>
            </div>
            <div id="distribution-plot"></div>
        </div>

        <div class="plot-container">
            <h3>ROC æ›²ç·š(Receiver Operating Characteristic Curve)</h3>
            <div id="roc-plot"></div>
        </div>

        <div class="explanation">
            <h3>ğŸ“Š é—œéµæ¦‚å¿µèªªæ˜</h3>
            <p><strong>åˆ‡å‰²é»è®ŠåŒ–çš„å½±éŸ¿:</strong></p>
            <ul>
                <li><strong>åˆ‡å‰²é»å¾€å·¦ç§»(é™ä½é–€æª»)</strong>:æ›´å¤šæ¨£æœ¬è¢«é æ¸¬ç‚ºé™½æ€§
                    <ul>
                        <li>TPR â†‘:æ›´å¤šçœŸé™½æ€§è¢«æ­£ç¢ºè­˜åˆ¥</li>
                        <li>FPR â†‘:ä½†ä¹Ÿæœƒæœ‰æ›´å¤šå‡é™½æ€§(èª¤å ±)</li>
                    </ul>
                </li>
                <li><strong>åˆ‡å‰²é»å¾€å³ç§»(æé«˜é–€æª»)</strong>:æ›´å°‘æ¨£æœ¬è¢«é æ¸¬ç‚ºé™½æ€§
                    <ul>
                        <li>TPR â†“:æœƒéŒ¯éä¸€äº›çœŸé™½æ€§</li>
                        <li>FPR â†“:ä½†å‡é™½æ€§ä¹Ÿæœƒæ¸›å°‘</li>
                    </ul>
                </li>
            </ul>
            <p><strong>ROC æ›²ç·šè§£è®€:</strong></p>
            <ul>
                <li>ROC æ›²ç·šé¡¯ç¤ºåœ¨æ‰€æœ‰å¯èƒ½çš„åˆ‡å‰²é»ä¸‹,TPR èˆ‡ FPR çš„é—œä¿‚</li>
                <li>æ›²ç·šè¶Šé è¿‘å·¦ä¸Šè§’(TPR é«˜ã€FPR ä½),æ¨¡å‹æ•ˆèƒ½è¶Šå¥½</li>
                <li>å°è§’ç·šä»£è¡¨éš¨æ©ŸçŒœæ¸¬çš„æ•ˆæœ(AUC = 0.5)</li>
                <li>AUC(æ›²ç·šä¸‹é¢ç©)è¶Šæ¥è¿‘ 1,æ¨¡å‹åˆ¤åˆ¥èƒ½åŠ›è¶Šå¼·</li>
            </ul>
        </div>
    </div>

    <script>
        // å¸¸æ…‹åˆ†ä½ˆçš„æ©Ÿç‡å¯†åº¦å‡½æ•¸
        function normalPDF(x, mean, std) {
            const coefficient = 1 / (std * Math.sqrt(2 * Math.PI));
            const exponent = -Math.pow(x - mean, 2) / (2 * Math.pow(std, 2));
            return coefficient * Math.exp(exponent);
        }

        // å¸¸æ…‹åˆ†ä½ˆçš„ç´¯ç©åˆ†ä½ˆå‡½æ•¸(ä½¿ç”¨èª¤å·®å‡½æ•¸è¿‘ä¼¼)
        function normalCDF(x, mean, std) {
            const z = (x - mean) / std;
            return 0.5 * (1 + erf(z / Math.sqrt(2)));
        }

        // èª¤å·®å‡½æ•¸è¿‘ä¼¼
        function erf(x) {
            const sign = x >= 0 ? 1 : -1;
            x = Math.abs(x);
            const a1 = 0.254829592;
            const a2 = -0.284496736;
            const a3 = 1.421413741;
            const a4 = -1.453152027;
            const a5 = 1.061405429;
            const p = 0.3275911;
            const t = 1 / (1 + p * x);
            const y = 1 - (((((a5 * t + a4) * t) + a3) * t + a2) * t + a1) * t * Math.exp(-x * x);
            return sign * y;
        }

        // è¨­å®šåƒæ•¸
        const negMean = -1;  // é™°æ€§æ¨£æœ¬çš„å¹³å‡å€¼
        const posMean = 1.5;   // é™½æ€§æ¨£æœ¬çš„å¹³å‡å€¼
        const std = 1;       // æ¨™æº–å·®

        // ç”Ÿæˆ x è»¸æ•¸æ“š
        const xRange = [];
        for (let x = -5; x <= 6; x += 0.05) {
            xRange.push(x);
        }

        // è¨ˆç®— TPR å’Œ FPR
        function calculateMetrics(threshold) {
            // TPR = P(é æ¸¬ç‚ºé™½æ€§ | çœŸå¯¦ç‚ºé™½æ€§) = P(X > threshold | X ~ N(posMean, std))
            const tpr = 1 - normalCDF(threshold, posMean, std);
            
            // FPR = P(é æ¸¬ç‚ºé™½æ€§ | çœŸå¯¦ç‚ºé™°æ€§) = P(X > threshold | X ~ N(negMean, std))
            const fpr = 1 - normalCDF(threshold, negMean, std);
            
            // TNR = P(é æ¸¬ç‚ºé™°æ€§ | çœŸå¯¦ç‚ºé™°æ€§)
            const tnr = normalCDF(threshold, negMean, std);
            
            // FNR = P(é æ¸¬ç‚ºé™°æ€§ | çœŸå¯¦ç‚ºé™½æ€§)
            const fnr = normalCDF(threshold, posMean, std);
            
            // å‡è¨­é™½æ€§å’Œé™°æ€§æ¨£æœ¬æ•¸é‡ç›¸ç­‰
            const precision = tpr / (tpr + fpr) || 0;
            const accuracy = (tpr + tnr) / 2;
            
            return { tpr, fpr, tnr, fnr, precision, accuracy };
        }

        // ç”Ÿæˆå®Œæ•´çš„ ROC æ›²ç·šæ•¸æ“š
        function generateROCCurve() {
            const thresholds = [];
            const tprValues = [];
            const fprValues = [];
            
            for (let t = -5; t <= 6; t += 0.1) {
                thresholds.push(t);
                const metrics = calculateMetrics(t);
                tprValues.push(metrics.tpr);
                fprValues.push(metrics.fpr);
            }
            
            return { thresholds, tprValues, fprValues };
        }

        // æ›´æ–°åœ–è¡¨
        function updatePlots() {
            const threshold = parseFloat(document.getElementById('threshold').value);
            document.getElementById('threshold-value').textContent = threshold.toFixed(2);
            
            const metrics = calculateMetrics(threshold);
            document.getElementById('fpr-value').textContent = metrics.fpr.toFixed(3);
            document.getElementById('tpr-value').textContent = metrics.tpr.toFixed(3);
            document.getElementById('precision-value').textContent = metrics.precision.toFixed(3);
            document.getElementById('accuracy-value').textContent = metrics.accuracy.toFixed(3);
            
            // æ›´æ–°åˆ†ä½ˆåœ–
            updateDistributionPlot(threshold);
            
            // æ›´æ–° ROC æ›²ç·š
            updateROCPlot(metrics.fpr, metrics.tpr);
        }

        // æ›´æ–°åˆ†ä½ˆåœ–
        function updateDistributionPlot(threshold) {
            const negDist = xRange.map(x => normalPDF(x, negMean, std));
            const posDist = xRange.map(x => normalPDF(x, posMean, std));
            
            const maxY = Math.max(...negDist, ...posDist);
            
            // é™°æ€§åˆ†ä½ˆ - å®Œæ•´æ›²ç·š
            const traceNeg = {
                x: xRange,
                y: negDist,
                type: 'scatter',
                mode: 'lines',
                name: 'é™°æ€§æ¨£æœ¬åˆ†ä½ˆ (TN + FP)',
                line: { color: '#2196F3', width: 3 },
                showlegend: true
            };
            
            // é™½æ€§åˆ†ä½ˆ - å®Œæ•´æ›²ç·š
            const tracePos = {
                x: xRange,
                y: posDist,
                type: 'scatter',
                mode: 'lines',
                name: 'é™½æ€§æ¨£æœ¬åˆ†ä½ˆ (TP + FN)',
                line: { color: '#f44336', width: 3 },
                showlegend: true
            };
            
            // TN å€åŸŸ(é™°æ€§åˆ†ä½ˆä¸­åˆ‡å‰²é»å·¦å´ - æ­£ç¢ºé æ¸¬ç‚ºé™°æ€§)
            const tnX = xRange.filter(x => x < threshold);
            const tnY = tnX.map(x => normalPDF(x, negMean, std));
            const traceTN = {
                x: tnX,
                y: tnY,
                type: 'scatter',
                mode: 'none',
                name: 'TN å€åŸŸ(çœŸé™°æ€§)',
                fill: 'tozeroy',
                fillcolor: 'rgba(33, 150, 243, 0.3)',
                showlegend: true
            };
            
            // FP å€åŸŸ(é™°æ€§åˆ†ä½ˆä¸­åˆ‡å‰²é»å³å´ - éŒ¯èª¤é æ¸¬ç‚ºé™½æ€§)
            const fpX = xRange.filter(x => x >= threshold);
            const fpY = fpX.map(x => normalPDF(x, negMean, std));
            const traceFP = {
                x: fpX,
                y: fpY,
                type: 'scatter',
                mode: 'none',
                name: 'FP å€åŸŸ(å½é™½æ€§) â†’ FPR',
                fill: 'tozeroy',
                fillcolor: 'rgba(255, 152, 0, 0.5)',
                showlegend: true
            };
            
            // FN å€åŸŸ(é™½æ€§åˆ†ä½ˆä¸­åˆ‡å‰²é»å·¦å´ - éŒ¯èª¤é æ¸¬ç‚ºé™°æ€§)
            const fnX = xRange.filter(x => x < threshold);
            const fnY = fnX.map(x => normalPDF(x, posMean, std));
            const traceFN = {
                x: fnX,
                y: fnY,
                type: 'scatter',
                mode: 'none',
                name: 'FN å€åŸŸ(å½é™°æ€§)',
                fill: 'tozeroy',
                fillcolor: 'rgba(156, 39, 176, 0.3)',
                showlegend: true
            };
            
            // TP å€åŸŸ(é™½æ€§åˆ†ä½ˆä¸­åˆ‡å‰²é»å³å´ - æ­£ç¢ºé æ¸¬ç‚ºé™½æ€§)
            const tpX = xRange.filter(x => x >= threshold);
            const tpY = tpX.map(x => normalPDF(x, posMean, std));
            const traceTP = {
                x: tpX,
                y: tpY,
                type: 'scatter',
                mode: 'none',
                name: 'TP å€åŸŸ(çœŸé™½æ€§) â†’ TPR',
                fill: 'tozeroy',
                fillcolor: 'rgba(76, 175, 80, 0.5)',
                showlegend: true
            };
            
            // åˆ‡å‰²ç·š
            const thresholdLine = {
                x: [threshold, threshold],
                y: [0, maxY * 1.1],
                type: 'scatter',
                mode: 'lines',
                name: `åˆ‡å‰²é» = ${threshold.toFixed(2)}`,
                line: { color: '#000', width: 3, dash: 'dash' },
                showlegend: true
            };
            
            const layout = {
                title: {
                    text: 'å¸¸æ…‹åˆ†ä½ˆ:é™°æ€§èˆ‡é™½æ€§æ¨£æœ¬çš„åˆ†æ•¸åˆ†ä½ˆ',
                    font: { size: 16, weight: 'bold' }
                },
                xaxis: { 
                    title: 'é æ¸¬åˆ†æ•¸(æ¨¡å‹è¼¸å‡ºå€¼)', 
                    gridcolor: '#e0e0e0',
                    zeroline: true
                },
                yaxis: { 
                    title: 'æ©Ÿç‡å¯†åº¦', 
                    gridcolor: '#e0e0e0' 
                },
                showlegend: true,
                legend: { 
                    x: 0.02, 
                    y: 0.98,
                    bgcolor: 'rgba(255, 255, 255, 0.8)',
                    bordercolor: '#ccc',
                    borderwidth: 1
                },
                plot_bgcolor: '#fafafa',
                paper_bgcolor: 'white',
                hovermode: 'closest',
                height: 500
            };
            
            Plotly.newPlot('distribution-plot', 
                [traceTN, traceFP, traceFN, traceTP, traceNeg, tracePos, thresholdLine], 
                layout, 
                {responsive: true}
            );
        }

        // æ›´æ–° ROC æ›²ç·š
        function updateROCPlot(currentFPR, currentTPR) {
            const rocData = generateROCCurve();
            
            // ROC æ›²ç·š
            const traceROC = {
                x: rocData.fprValues,
                y: rocData.tprValues,
                type: 'scatter',
                mode: 'lines',
                name: 'ROC æ›²ç·š',
                line: { color: '#4CAF50', width: 3 }
            };
            
            // å°è§’ç·š(éš¨æ©ŸçŒœæ¸¬)
            const traceDiagonal = {
                x: [0, 1],
                y: [0, 1],
                type: 'scatter',
                mode: 'lines',
                name: 'éš¨æ©ŸçŒœæ¸¬',
                line: { color: '#999', width: 2, dash: 'dash' }
            };
            
            // ç•¶å‰é»
            const traceCurrent = {
                x: [currentFPR],
                y: [currentTPR],
                type: 'scatter',
                mode: 'markers',
                name: 'ç•¶å‰åˆ‡å‰²é»',
                marker: { color: '#FF9800', size: 15, symbol: 'circle' }
            };
            
            // è¨ˆç®— AUC(ä½¿ç”¨æ¢¯å½¢æ³•å‰‡)
            let auc = 0;
            for (let i = 0; i < rocData.fprValues.length - 1; i++) {
                const width = rocData.fprValues[i + 1] - rocData.fprValues[i];
                const avgHeight = (rocData.tprValues[i] + rocData.tprValues[i + 1]) / 2;
                auc += width * avgHeight;
            }
            
            const layout = {
                title: `ROC æ›²ç·š (AUC = ${Math.abs(auc).toFixed(3)})`,
                xaxis: { 
                    title: 'False Positive Rate (FPR)',
                    range: [0, 1],
                    gridcolor: '#e0e0e0'
                },
                yaxis: { 
                    title: 'True Positive Rate (TPR)',
                    range: [0, 1],
                    gridcolor: '#e0e0e0'
                },
                showlegend: true,
                legend: { x: 0.6, y: 0.1 },
                plot_bgcolor: '#fafafa',
                paper_bgcolor: 'white',
                hovermode: 'closest'
            };
            
            Plotly.newPlot('roc-plot', [traceROC, traceDiagonal, traceCurrent], layout, {responsive: true});
        }

        // ç›£è½æ»‘æ¡¿è®ŠåŒ–
        document.getElementById('threshold').addEventListener('input', updatePlots);

        // åˆå§‹åŒ–
        updatePlots();
    </script>
</body>
</html>
